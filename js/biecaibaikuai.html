<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title></title>
	<link rel="stylesheet" href="">
	<style>
		#main{
			border:2px solid blue;
			width:400px;
			height:400px;
			margin:0 auto;
			position: relative;
			overflow: hidden;
		}
		#container{
			width:100%;
			height:400px;
			position: relative;
			left: 0;
			top: -100px;
			background-color: white;
		}
		.row{
			width:100%;
			height:100px;
		}
		.ceil{
			width:100px;
			height:100px;
			float:left;
		}
		.black{
			background-color: black;
		}
		h1{
			text-align: center;
		}
	</style>
</head>
<body>
	<h1>您的分数：<scan id="score">0</scan></h1>
	<div id="main">
		<div id="container"></div>
	</div>
</body>
<script>
	var clock = null;//定时器
	var status = 0;//0：未开始，1：已开始，2：暂停，3：游戏失败
	var blockNum = 0;//黑块的数目
	var speed = 1;//初始速度
	/**
	 * 创建一个单元
	 * @param  {str} className 类名
	 * @return {obj}           对象
	 */
	function cdiv(className){
		var div = document.createElement('div');
		div.className = className;
		return div;
	}

	/**
	 * 创建一行，并添加到容器中
	 * @return void 
	 */
	function crow(){
		var row = cdiv('row');
		var arr = editClass();
		for(var i=0;i<4;i++){
			row.appendChild(cdiv(arr[i]));
		}
		//添加到容器中
		var container = $('container');
		//如果是第一个节点，就以追加的方式插入;否则，插入到第一个节点上
		if(container.firstChild == null){
			container.appendChild(row);
		}else{
			container.insertBefore(row,container.firstChild);
		}
		blockNum++;//黑块的数量加1
	}

	/**
	 * 初始化方法
	 * @return void
	 */
	function init(){
		for(var i=0;i<4;i++){
			crow();
		}

		//事件委托
		$('main').onclick = function (ev){
			judge(ev);
		}
	}

	/**
	 * 根据点击判断是否成功
	 * @param  obj ev 事件对象
	 * @return void	 
	 */
	function judge(ev){
		//如果游戏已经失败，就不能继续玩了
		if(status == 3){
			alert('你已经失败了，要不要脸');
			return ;
		}
		if(ev.target.className.indexOf('black') == -1){
			fail();
		}else{
			ev.target.className = 'ceil';//将黑块变为白块
			score();//计分
			blockNum--;//黑块数量减1
		}
	}

	/**
	 * 失败后的操作
	 * @return {[type]} [description]
	 */
	function fail(){
		clearInterval(clock);//停止定时器工作
		status = 3;//设置游戏状态
		alert('您输了');//弹出错误信息
	}

	/**
	 * 计分函数
	 * @return void
	 */
	function score(){
		var s = parseInt($('score').innerHTML);
		$('score').innerHTML = ++s;
		if(s % 10 == 0){
			jiasu();
		}
	}
	
	/**
	 * 加速函数
	 * @return void 
	 */
	function jiasu(){
		if(speed > 30){
			alert('电脑带不动了');
		}else{
			speed += 1;
		}
	}

	/**
	 * 修改类名，每行都有一个黑色的单元格
	 * @return {arr} 类名数组
	 */
	function editClass(){
		var arr = ['ceil','ceil','ceil','ceil'];//创建数组
		var i = Math.floor(Math.random()*4);//获取0-3随机数
		arr[i] = 'ceil black';
		return arr;
	}

	/**
	 * 容器移动
	 * @return void 
	 */
	function move(){
		var container = $('container');
		var top = parseInt(window.getComputedStyle(container,null)['top']);
		//设置不能走过了
		if(top + speed > 0){
			top = 0;
		}else{
			top = top + speed;//控制下落的速度
		}
		container.style.top = top+'px';

		//如果移动到0位置处，就新建一行，然后重新设置起点为-100，并删除最后一行
		if(top == 0){
			crow();
			container.style.top = '-100px';
			//如果黑块为5块就说明触底了，也是游戏结束
			if(blockNum >= 5){
				fail();
				return;
			}
			delLastChild();//删除最后一行
		}
	}

	/**
	 * 删除最后一行
	 * @return void 
	 */
	function delLastChild(){
		var container = $('container');
		container.removeChild(container.lastChild);
	}

	/**
	 * 游戏开始函数
	 * @return void
	 */
	function start(){
		clock = setInterval('move()',20);
	}

	/**
	 * 封装工具方法
	 * @param  {str} id 
	 * @return {obj}    对象
	 */
	function $(id){
		return document.getElementById(id);
	}

	init();
	start();
</script>
</html>